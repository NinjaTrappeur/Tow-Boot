From 42a37d3b168334cde109073a444fee6bb881131a Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?F=C3=A9lix=20Baylac=20Jacqu=C3=A9?=
 <felix@alternativebit.fr>
Date: Thu, 19 Jan 2023 15:08:49 +0100
Subject: [PATCH] Towboot-debug: heh, did not find a better way to debug

---
 common/usb_kbd.c | 13 ++++++++-----
 1 file changed, 8 insertions(+), 5 deletions(-)

diff --git a/common/usb_kbd.c b/common/usb_kbd.c
index 352d86fb2e..307ce16b1d 100644
--- a/common/usb_kbd.c
+++ b/common/usb_kbd.c
@@ -494,7 +494,7 @@ static int usb_kbd_probe_dev(struct usb_device *dev, unsigned int ifnum)
 	if (epNum == iface->desc.bNumEndpoints)
 		return 0;
 
-	debug("USB KBD: found interrupt EP: 0x%x\n", ep->bEndpointAddress);
+	printf("USB KBD: found interrupt EP: 0x%x\n", ep->bEndpointAddress);
 
 	data = malloc(sizeof(struct usb_kbd_pdata));
 	if (!data) {
@@ -522,19 +522,19 @@ static int usb_kbd_probe_dev(struct usb_device *dev, unsigned int ifnum)
 	data->last_report = -1;
 
 	/* We found a USB Keyboard, install it. */
-	debug("USB KBD: set boot protocol\n");
+	printf("USB KBD: set boot protocol\n");
 	usb_set_protocol(dev, iface->desc.bInterfaceNumber, 0);
 
 #if !defined(CONFIG_SYS_USB_EVENT_POLL_VIA_CONTROL_EP) && \
     !defined(CONFIG_SYS_USB_EVENT_POLL_VIA_INT_QUEUE)
-	debug("USB KBD: set idle interval...\n");
+	printf("USB KBD: set idle interval...\n");
 	usb_set_idle(dev, iface->desc.bInterfaceNumber, REPEAT_RATE / 4, 0);
 #else
-	debug("USB KBD: set idle interval=0...\n");
+	printf("USB KBD: set idle interval=0...\n");
 	usb_set_idle(dev, iface->desc.bInterfaceNumber, 0, 0);
 #endif
 
-	debug("USB KBD: enable interrupt pipe...\n");
+	printf("USB KBD: enable interrupt pipe...\n");
 #ifdef CONFIG_SYS_USB_EVENT_POLL_VIA_INT_QUEUE
 	data->intq = create_int_queue(dev, data->intpipe, 1,
 				      USB_KBD_BOOT_REPORT_SIZE, data->new,
@@ -549,6 +549,9 @@ static int usb_kbd_probe_dev(struct usb_device *dev, unsigned int ifnum)
 #endif
 		printf("Failed to get keyboard state from device %04x:%04x\n",
 		       dev->descriptor.idVendor, dev->descriptor.idProduct);
+                printf("TOWBOOT-DEBUG: sleeping to give you a chance to take a pic of the actual error.\n");
+		udelay(120000000);
+
 		/* Abort, we don't want to use that non-functional keyboard. */
 		return 0;
 	}
-- 
2.38.1

